<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Contract Interaction</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Supplier Contract Interaction</h1>

        <div class="mb-4">
            <h2>Add Supply</h2>
            <div class="mb-3">
                <label for="supplierId" class="form-label">Supplier ID:</label>
                <input type="number" class="form-control" id="supplierId">
            </div>
            <div class="mb-3">
                <label for="packages" class="form-label">Packages (comma separated):</label>
                <input type="text" class="form-control" id="packages">
            </div>
            <button class="btn btn-primary" onclick="addSupplier()">Add Supply</button>
        </div>

        <div class="mb-4">
            <h2>Get Supplier Details</h2>
            <div class="mb-3">
                <label for="supplierIndex" class="form-label">Supplier Index:</label>
                <input type="number" class="form-control" id="supplierIndex">
            </div>
            <button class="btn btn-primary" onclick="getSupplier()">Get Supplier</button>
        </div>

        <div class="mb-4">
            <h2>Find Suppliers by Package</h2>
            <div class="mb-3">
                <label for="searchPackage" class="form-label">Package Name:</label>
                <input type="text" class="form-control" id="searchPackage">
            </div>
            <button class="btn btn-primary" onclick="findSuppliersByPackage()">Search</button>
            <p id="suppliersByPackage" class="mt-3"></p>
        </div>

        <div class="mb-4">
            <h2>Get Supplies by Supplier ID</h2>
            <div class="mb-3">
                <label for="supplierIdSupplies" class="form-label">Supplier ID:</label>
                <input type="number" class="form-control" id="supplierIdSupplies">
            </div>
            <button class="btn btn-primary" onclick="getSuppliesById()">Get Supplies</button>
            <p id="suppliesById" class="mt-3"></p>
        </div>

        <div class="mb-4">
            <h2>Get All Supplies</h2>
            <button class="btn btn-primary" onclick="getAllSupplies()">Get All Supplies</button>
            <p id="allSupplies" class="mt-3"></p>
        </div>
    </div>

    <script>
        // Check if MetaMask is installed
        if (typeof window.ethereum !== 'undefined') {
            window.web3 = new Web3(ethereum);
            ethereum.enable(); // Request user permission
        } else {
            console.error('MetaMask not installed');
        }

        const web3 = window.web3;

        // Replace with your actual contract address and ABI
        const contractAddress = '0x758dcED0d0F75fe9EC021321b5bBb6C4A8F5b047';
        const contractABI = [
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_supplier_id",
				"type": "uint256"
			},
			{
				"internalType": "string[]",
				"name": "_packages",
				"type": "string[]"
			}
		],
		"name": "addSupplier",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_package",
				"type": "string"
			}
		],
		"name": "findSupplierByPackage",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getAllSupplies",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			},
			{
				"internalType": "string[]",
				"name": "",
				"type": "string[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "getSupplier",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "string[]",
				"name": "",
				"type": "string[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getSupplierCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_supplierId",
				"type": "uint256"
			}
		],
		"name": "getSuppliesById",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "",
				"type": "string[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "suppliers",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "supplier_id",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
        const contract = new web3.eth.Contract(contractABI, contractAddress);

        async function addSupplier() {
            const supplierId = document.getElementById('supplierId').value;
            const packages = document.getElementById('packages').value.split(',');

            try {
                const accounts = await ethereum.request({ method: 'eth_accounts' });
                const from = accounts[0];

                await contract.methods.addSupplier(supplierId, packages)
                    .send({ from: from });

                alert('Supplier added successfully');
            } catch (error) {
                console.error(error);
            }
        }

        async function getSupplier() {
            const supplierIndex = document.getElementById('supplierIndex').value;

            try {
                const result = await contract.methods.getSupplier(supplierIndex).call();
                alert(`Supplier ID: ${result[0]}\nPackages: ${result[1].join(', ')}`);
            } catch (error) {
                console.error(error);
            }
        }

        async function findSuppliersByPackage() {
            const searchPackage = document.getElementById('searchPackage').value;

            try {
                const result = await contract.methods.findSupplierByPackage(searchPackage).call();
                document.getElementById('suppliersByPackage').innerText = result.join(', ');
            } catch (error) {
                console.error(error);
            }
        }

        async function getSuppliesById() {
            const supplierIdSupplies = document.getElementById('supplierIdSupplies').value;

            try {
                const result = await contract.methods.getSuppliesById(supplierIdSupplies).call();
                document.getElementById('suppliesById').innerText = result.join(', ');
            } catch (error) {
                console.error(error);
            }
        }

        async function getAllSupplies() {
            try {
                const result = await contract.methods.getAllSupplies().call();
                const supplierIds = result[0].join(', ');
                const allSupplies = result[1].join(', ');
                document.getElementById('allSupplies').innerText = `Supplier IDs: ${supplierIds}\nAll Supplies: ${allSupplies}`;
            } catch (error) {
                console.error(error);
            }
        }
    </script>
</body>
</html>